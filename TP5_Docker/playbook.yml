---
# Examples use the django example at https://docs.docker.com/compose/django. Follow it to create the
# files directory

- name: Run using a project directory
  hosts: all
  gather_facts: false
    #include_vars: "vars/{{environnement}}.yml"

  tasks:
    - name: Create a directory if it does not exist
      ansible.builtin.file:
        path: "/root/TP5_Docker/"
        state: directory
        mode: '0755'

    - name: Copy file with owner and permissions
      ansible.builtin.copy:
        src: "./files/{{ item }}"
        dest: "/root/TP5_Docker/"
        mode: '0644'
      loop:
        - docker-compose.yml
        - index.html

    - name: Tear down existing services
      community.docker.docker_compose_v2:
        project_src: "/root/TP5_Docker"
        state: absent

    - name: Create and start services
      community.docker.docker_compose_v2:
        project_src: "/root/TP5_Docker"
        state: present
      register: output

    - name: Show results
      ansible.builtin.debug:
        var: output
